<html>
  <head>
    <meta charset="utf-8">
    <script type="text/javascript" src="js/main.js"></script>
    <script src="jquery.js"></script>
    <!-- <link rel="stylesheet" type="text/css" href="index.css"> -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"/>
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Roboto', sans-serif;
      }

      #sidebar {
        color: whitesmoke;
        text-align: center;
        width: 20%;
        height: 100%;
        float: left;
        background-color: rgb(105, 19, 145);
      }

      a {
        color: whitesmoke;
      }
    </style>
  </head>

  <body>

    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>

    <div id="sidebar"></div>
    <div id="map" style="width: 80%; height: 100%"></div>

    <script>
      var clearSidebar = function () {
        $("#sidebar").empty();
      }

      var populateSidebarCityPrices = function (regionPrices) {
        var bar = $("#sidebar");
        bar.append("<h2>Wellington</h2>");
        regionPrices.forEach(function(element) {
          bar.append(`<p>${element[0]} - $${element[1]}</p>`);
        });
      }

      var populateSidebarSuburbInfo = function (imageUrl, name, desc, median, available) {
        $("#sidebar").append(`<img id="sidebarImage" src="${imageUrl}" style="object-fit: cover; width: 100%;"/>`)
          .append(`<h2>${name}</h2>`)
          .append(`<p>${desc}</p>`)
          .append("<h2>Median Price:</h2>")
          .append(`<p>$${median}</p>`)
          .append("<h2>Properties Available:</h2>")
          .append(`<p>${available}</p>`);
        var imgWidth = $("#sidebarImage").width();
        $('#sidebarImage').css({'height':imgWidth+'px'});
      }

      var populatePropertyInfo = function (imageUrl, address, suburb, total, room, bedroom, bathroom, garage, link, desc) {
        $("#sidebar").append(`<img id="sidebarImage" src="${imageUrl}" style="object-fit: cover; width: 100%;"/>`)
          .append(`<h2>${address}<br/>${suburb}<br/>Wellington</h2>`)
          .append(`<p>$${total} per week </p>`)
          .append(`<p>$${room} per person</p>`)
          .append(`<p>${bedroom} bedroom</p>`)
          .append(`<p>${bathroom} bathroom</p>`)
          .append(`<p>${garage} garage</p>`)
          .append(`<a href="${link}">Listing</a>`)
          .append(`<p>${desc}</p>`);
      }

      rentals = [];
      regions = [["Te Aro", 300], ["Kelburn", 200], ["Mount Victoria", 250]];
      var dataPointIcon = L.icon({
        iconUrl: '/Images/PointMarker.png',
        iconSize: [20, 20],
      });

      // Create variable to hold map element, give initial settings to map
      var map = L.map('map',{ center: [-41.285267, 174.776822], zoom: 14});
      // Add OpenStreetMap tile layer to map element
      L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png', { attribution: 'Map tiles by Carto, under CC BY 3.0. Data by OpenStreetMap, under ODbL.' }).addTo(map);
      // Create point feature for Kendall Square T Station

       $.getJSON("data/WCC_Suburbs_Boundaries.geojson",function(data){

        L.geoJson(data).addTo(map);
      });

      $.getJSON("http://localhost:3000/listings", function(data){
      
       //console.log(data);
       data.forEach((element) => {
         rentals.push(element);
       })

       rentals.forEach((element) =>{
         var myDataPoint = L.marker([element.geoLoc.Latitude, element.geoLoc.Longitude], {icon: dataPointIcon}).addTo(map);
         myDataPoint.bindTooltip("$"+element.rentPerRoom, {permanent: true}).openTooltip();

         myDataPoint.bindPopup('<img src="../../Images/housePlaceholder.jpg" width="100" height="80"><br> <p>$'+element.rentPerRoom+'</p>');
       })
     });

     /* example code
     populateSidebarCityPrices(regions);
     clearSidebar();
     populatePropertyInfo("https://mediaserver.realestate.co.nz/listings/2431634/c16ce5d4a8088d683081800f37364ab6.crop.990x661.jpg", "1 Blair Lair Lane", "Te Aro", 300, 100, 3, 1, 0, "https://google.com", "Yeah the boys")
     */
    </script>




</html>
